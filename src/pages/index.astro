---
import { getCollection } from "astro:content";
import Layout from "../layouts/FiltersLayout.astro";

const posts = await getCollection("articles");

const categoryCounts = {};

posts.forEach((post) => {
  categoryCounts[post.data.category] =
    (categoryCounts[post.data.category] || 0) + 1;
});

const sortedCategories = Object.entries(categoryCounts).sort(
  ([, a], [, b]) => b - a,
);

const tagCounts = {};

posts.forEach((post) => {
  post.data.tags?.forEach((tag) => {
    tagCounts[tag] = (tagCounts[tag] || 0) + 1;
  });
});

const sortedTags = Object.entries(tagCounts).sort(([, a], [, b]) => b - a);

const areas = ["ASIE",
"FRANCOPHONIE",
"EUROPE",
"EUROPE COMMUNISTE",
"INTERNATIONAL",
"MOYEN-ORIENT",
"AFRIQUE",
"AMERIQUE DU NORD",
"AMERIQUE DU SUD",
"AMERIQUE LATINE",
"ASIE CENTRALE",
"OCEANIE"];
---

<Layout title="Témoignages gédéons">
  <h1>Témoignages gédéons&nbsp;({posts.length})</h1>
  <section id="news">
    <h2>Filtrer par categorie</h2>
    <ul>
      {
        sortedCategories.map(([category, count]) => (
          <li>
            <a href={`/categories/${category}/`} class="link">
              {category}
            </a>
            &nbsp;({count})
          </li>
        ))
      }
    </ul>
  </section>
  <section  id="areas">
    <h2>Filtrer par tag (région)</h2>
    <ul>
      {
        sortedTags
        .filter(([tag]) => areas.includes(tag))
        .map(([tag, count]) => (
          <li>
            <a href={`/tags/${tag}/`} class="link">
              {tag}
            </a>
            &nbsp;({count})
          </li>
        ))
      }
    </ul>
  </section>
    <section  id="countries">
    <h2>Filtrer par tag (pays)</h2>
    <ul>
      {
        sortedTags
         .filter(([tag]) => !areas.includes(tag))
         .map(([tag, count]) => (
          <li>
            <a href={`/tags/${tag}/`} class="link">
              {tag}
            </a>
            &nbsp;({count})
          </li>
        ))
      }
    </ul>
  </section>
  <section>
  <a href="/docs/" id="news" class="box">
    <h2>Documentation technique</h2>
     </a>
    <p>A propos de la technologie Astro de génération d'un site statique à partir de documents <a href="https://www.markdownlang.com/fr/">Markdown</a> </p>
  </section>
</Layout>
